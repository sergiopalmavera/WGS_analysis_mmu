### Chr-Manhattan Windowed Fst
```{r, eval = F}
# run once to export and then import with next chunk
for(chr in unique(manhattan_dat$CHROM)){

  fl_nm <- paste0("manhattan_genomewide_fst_chr",chr,".png")

  manhattan_dat %>% 
    filter(CHROM == chr) %>% 
    ungroup() %>% 
    mutate(CHROM = paste0("Chromosome ", CHROM)) %>% 
    ggplot(data = ., mapping = aes(x = center_mb, y = MEAN_FST)) +
      geom_point(alpha = 0.5) +
      theme_bw(base_size = 15) +
      scale_color_manual(values = "darkgrey") +
      scale_x_continuous(breaks = scales::pretty_breaks(n = 15), expand = c(0,0)) + 
      facet_grid(contrast ~ CHROM) +
      xlab("Mb") +
      ylab("Mean Window Fst")
      ggsave(
        filename = fl_nm, 
        device = "png",
        path = here("00_dashboard/figures"),
        width = 15,
        height = 10,
        units = "in",
        dpi = 300
      )
}
```

```{r, fig.width=12}
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr1.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr2.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr3.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr4.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr5.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr6.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr7.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr8.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr9.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr10.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr11.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr12.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr13.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr14.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr15.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr16.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr17.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr18.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chr19.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_fst_chrX.png"))
```


### Chr-Manhattan z(Windowed Fst)
```{r, eval = F}
# run once to export and then import with next chunk
for(chr in unique(manhattan_dat$CHROM)){

  fl_nm <- paste0("manhattan_genomewide_z_fst_chr",chr,".png")

  manhattan_dat %>% 
    filter(CHROM == chr) %>% 
    ungroup() %>% 
    mutate(CHROM = paste0("Chromosome ", CHROM)) %>% 
    ggplot(data = ., mapping = aes(x = center_mb, y = z_win_fst_score)) +
      geom_point(alpha = 0.5) +
      theme_bw(base_size = 15) +
      scale_color_manual(values = "darkgrey") +
      scale_x_continuous(breaks = scales::pretty_breaks(n = 15), expand = c(0,0)) + 
      facet_grid(contrast ~ CHROM) +
      xlab("Mb") +
      ylab("Mean Window Fst") +
      geom_hline(filter(q, quantile == "q95"), mapping = aes(yintercept = zFst), linetype = "dashed", color = "blue") +
      geom_hline(filter(q, quantile == "q99"), mapping = aes(yintercept = zFst), linetype = "dashed", color = "red") +
      ggsave(
        filename = fl_nm, 
        device = "png",
        path = here("00_dashboard/figures"),
        width = 15,
        height = 10,
        units = "in",
        dpi = 300
      )
}
```


```{r, fig.width=12}
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr1.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr2.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr3.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr4.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr5.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr6.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr7.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr8.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr9.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr10.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr11.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr12.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr13.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr14.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr15.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr16.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr17.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr18.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chr19.png"))
include_graphics(here("00_dashboard/figures","manhattan_genomewide_z_fst_chrX.png"))
```



Diversity ratio
==================
```{r pi_ratio_tables,include=F}
fls <- list.files(here("batches123_07_selection_analysis/02_pi_ratio/output"), pattern = ".csv$", full.names = T)

pi_ratio_dat <- lapply(fls, function(fl){
  read.csv(fl) %>% dplyr::select(CHROM, BIN_START, BIN_END, pi_ratio)
})

names(pi_ratio_dat) <- basename(fls) %>% str_remove("pi_ratio_") %>% str_remove(".csv")

pi_ratio_dat <- pi_ratio_dat %>% 
  bind_rows(.id = "contrast") %>% 
  mutate(pi_ratio_log2 = log2(pi_ratio))
```

### Summary
```{r summary_win_fst}
summary_win_pi_ratio <- pi_ratio_dat %>% 
  mutate(is_x = (CHROM == "X")) %>% 
  group_by(contrast, is_x) %>% 
  summarise(
    n_win = n(),
    min = min(pi_ratio),
    q1 = quantile(pi_ratio, 0.01),
    q5 = quantile(pi_ratio, 0.05),
    median = median(pi_ratio),
    mean = mean(pi_ratio),
    max = max(pi_ratio)
    ) %>% 
  arrange(is_x)

summary_win_pi_ratio %>%
  mutate(is_x = ifelse(is_x, "X", "Autosome")) %>% 
  dplyr::rename(chr_type = is_x) %>% 
  kable(digits = 2, caption = "Mean Window pi_ratio")
```

### Distribution
```{r, fig.width=10,fig.height=7}

p1 <- pi_ratio_dat %>% 
  ggplot(aes(x = pi_ratio)) +
    geom_histogram(bins = 50) +
    facet_wrap(~contrast, ncol = 1, strip.position = "right") +
    theme_bw() +
    xlab("pi-ratio")

p2 <- pi_ratio_dat %>% 
  ggplot(aes(x = NA, y = pi_ratio)) +
    geom_boxplot(width = 0.2) +
    coord_flip() +
    facet_wrap(~contrast, ncol = 1, strip.position = "right") +
    theme_bw() +
    theme(
      axis.text.y = element_blank(),
      axis.title.y = element_blank(),
      axis.ticks.y = element_blank()
    ) +
    ylab("pi-ratio")

gridExtra::grid.arrange(p1,p2, nrow = 1)

rm(p1,p2)  
```
