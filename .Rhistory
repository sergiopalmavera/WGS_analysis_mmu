sample_info <- read.csv(here("sample_info/sample_info_batch1_batch2.csv")) %>%
dplyr::select(Linie, sample_id) %>%
bind_rows(
read.csv(here("sample_info/sample_info_batch3/sample_info.csv")) %>%
dplyr::select(Linie,name) %>%
dplyr::rename(sample_id = name)
) %>%
mutate(Linie = ifelse(Linie == "HLB", "DUhLB",Linie),
sample_id = str_remove(sample_id,"-S1"))
final_vcf_metrics_detail <- read.delim(here("batches123_04_FinalVCF/metrics/cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.table.variant_calling_detail_metrics"), stringsAsFactors = F, comment.char = "#", dec = ",") %>%
mutate(SAMPLE_ALIAS2 = str_remove(SAMPLE_ALIAS, "-L1"),
SAMPLE_ALIAS2 = str_remove(SAMPLE_ALIAS2, "-S1")) %>%
left_join(sample_info, by = c("SAMPLE_ALIAS2" = "sample_id")) %>%
mutate(Linie = factor(Linie, levels = c("DUK","DUC","DU6","DU6P","DUhLB","FZTDU"))) %>%
arrange(Linie, SAMPLE_ALIAS2)
fx <- function(l){
final_vcf_metrics_detail %>%
filter(Linie == l) %>%
dplyr::select(SAMPLE_ALIAS) %>% View()
#write.table(paste0("sample_info/vcf_samples_",l), quote = F, col.names = F, row.names = F)
}
fx("DUK")
fx("DU6")
library(here)
library(dplyr)
library(stringr)
sample_info <- read.csv(here("sample_info/sample_info_batch1_batch2.csv")) %>%
dplyr::select(Linie, sample_id) %>%
bind_rows(
read.csv(here("sample_info/sample_info_batch3/sample_info.csv")) %>%
dplyr::select(Linie,name) %>%
dplyr::rename(sample_id = name)
) %>%
mutate(Linie = ifelse(Linie == "HLB", "DUhLB",Linie),
sample_id = str_remove(sample_id,"-S1"))
final_vcf_metrics_detail <- read.delim(here("batches123_04_FinalVCF/metrics/cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.table.variant_calling_detail_metrics"), stringsAsFactors = F, comment.char = "#", dec = ",") %>%
mutate(SAMPLE_ALIAS2 = str_remove(SAMPLE_ALIAS, "-L1"),
SAMPLE_ALIAS2 = str_remove(SAMPLE_ALIAS2, "-S1")) %>%
left_join(sample_info, by = c("SAMPLE_ALIAS2" = "sample_id")) %>%
mutate(Linie = factor(Linie, levels = c("DUK","DUC","DU6","DU6P","DUhLB","FZTDU"))) %>%
arrange(Linie, SAMPLE_ALIAS2)
fx <- function(l){
final_vcf_metrics_detail %>%
filter(Linie == l) %>%
dplyr::select(SAMPLE_ALIAS) %>%
write.table(paste0("sample_info/vcf_samples_",l), quote = F, col.names = F, row.names = F)
}
fx("DUK")
fx("DUC")
fx("DU6")
fx("DU6P")
fx("DUhLB")
fx("FZTDU")
here("batches123_04_FinalVCF/metrics") %>% list.files()
here("batches123_04_FinalVCF/metrics") %>% list.files() %>% .[grep("summary",.)]
here("batches123_04_FinalVCF/metrics") %>% list.files() %>% .[grep("DU",.)]
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)]
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
read.table(x,stringsAsFactors = F,dec = ",",comment.char = "#")
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
#read.table(x,stringsAsFactors = F,dec = ",",comment.char = "#")
print(x)
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#")
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#", header = F)
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#", header = T)
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#", header = T)
}) %>%
bind_rows()
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
d <- read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#", header = T)
l <- str_remove(x,"cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".variant_calling_summary_metrics")
d %>% mutate(line = l) %>% dplyr::select(line, everything())
})
here("batches123_04_FinalVCF/metrics") %>%
list.files() %>%
.[grep("DU",.)] %>%
.[grep("summary",.)] %>%
lapply(function(x){
d <- read.table(here("batches123_04_FinalVCF/metrics",x),stringsAsFactors = F,dec = ",",comment.char = "#", header = T)
l <- str_remove(x,"cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".variant_calling_summary_metrics")
d %>% mutate(line = l) %>% dplyr::select(line, everything())
}) %>%
bind_rows()
library("UpSetR")
install.packages("UpSetR")
library(UpSetR)
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
fls
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl)) %>%
mutate(line = ln, snp_id = paste0(V1,"_",V2))
return(d)
})
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl)) #%>% mutate(line = ln, snp_id = paste0(V1,"_",V2))
return(d)
})
snp_ids %>% lapply(head)
?vroom
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl, col_names = F)) #%>% mutate(line = ln, snp_id = paste0(V1,"_",V2))
return(d)
})
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl), col_names = F) #%>% mutate(line = ln, snp_id = paste0(V1,"_",V2))
return(d)
})
snp_ids %>% lapply(head)
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl), col_names = F) %>% mutate(line = ln, snp_id = paste0(X1,"_",X2))
return(d)
})
snp_ids %>% lapply(head)
str_remove(fls, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
names(snp_ids) <- str_remove(fls, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
all_ids <- snp_ids %>% bind_rows() %>% select(-line, -X1, -X2) %>% unique() %>% unlist()
head(all_ids)
head(snp_ids)
library(data.table)
sets <- snp_idsa.frame(ids = all_ids,
duk = as.integer(all_ids %chin% snp_ids$DUK$snp_ids),
duc = as.integer(all_ids %chin% snp_ids$DUC$snp_ids),
du6 = as.integer(all_ids %chin% snp_ids$DU6$snp_ids),
du6p = as.integer(all_ids %chin% snp_ids$DU6P$snp_ids),
duhlb = as.integer(all_ids %chin% snp_ids$DUhLB$snp_ids),
fztdu = as.integer(all_ids %chin% snp_ids$FZTDU$snp_ids))
sets <- data.frame(ids = all_ids,
duk = as.integer(all_ids %chin% snp_ids$DUK$snp_ids),
duc = as.integer(all_ids %chin% snp_ids$DUC$snp_ids),
du6 = as.integer(all_ids %chin% snp_ids$DU6$snp_ids),
du6p = as.integer(all_ids %chin% snp_ids$DU6P$snp_ids),
duhlb = as.integer(all_ids %chin% snp_ids$DUhLB$snp_ids),
fztdu = as.integer(all_ids %chin% snp_ids$FZTDU$snp_ids))
head(sets)
xx <- all_ids %chin% snp_ids$DUK$snp_ids
sets <- data.frame(ids = all_ids,
duk = as.integer(all_ids %chin% snp_ids$DUK$snp_id),
duc = as.integer(all_ids %chin% snp_ids$DUC$snp_id),
du6 = as.integer(all_ids %chin% snp_ids$DU6$snp_id),
du6p = as.integer(all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = as.integer(all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = as.integer(all_ids %chin% snp_ids$FZTDU$snp_id))
head(sets)
dim(sets)
write.table(sets, here("00_dashboard/data","snp_id_sets.csv"))
rm(sets)
set_dat <- read.csv(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T)
head(set_dat)
dim(set_dat)
set_dat <- read.csv2(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T)
head(set_dat)
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl), col_names = F) %>% mutate(line = ln, snp_id = paste0(X1,"_",X2))
return(d)
})
names(snp_ids) <- str_remove(fls, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
all_ids <- snp_ids %>% bind_rows() %>% select(-line, -X1, -X2) %>% unique() %>% unlist()
sets <- data.frame(ids = all_ids,
duk = as.integer(all_ids %chin% snp_ids$DUK$snp_id),
duc = as.integer(all_ids %chin% snp_ids$DUC$snp_id),
du6 = as.integer(all_ids %chin% snp_ids$DU6$snp_id),
du6p = as.integer(all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = as.integer(all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = as.integer(all_ids %chin% snp_ids$FZTDU$snp_id))
write.csv(sets, here("00_dashboard/data","snp_id_sets.csv"))
ttt <- read.csv(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T)
head(ttt)
dim(ttt)
ttt <- read.csv(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T) %>% dplyr::select(-X)
head(ttt)
set_dat <- ttt
head(set_dat)
fls <- here("batches123_04_FinalVCF/output/") %>% list.files(pattern = "*.snpIDs")
snp_ids <- lapply(fls, function(fl){
ln <- str_remove(fl, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
d <- vroom(here("batches123_04_FinalVCF/output",fl), col_names = F) %>% mutate(line = ln, snp_id = paste0(X1,"_",X2))
return(d)
})
names(snp_ids) <- str_remove(fls, "cohort_biallelicSNPs_VQSR95_PASS_AddedMissingness.recode.filtered.") %>%
str_remove(".snpIDs")
install.packages("venn")
library(venn)
venn(5)
venn(6)
zones <- getZones("0---1")
polygon(zones[[1]], col="lightblue")
polygon(zones[[2]], col="lightblue")
sets <- data.frame(ids = all_ids,
duk = (all_ids %chin% snp_ids$DUK$snp_id),
duc = (all_ids %chin% snp_ids$DUC$snp_id),
du6 = (all_ids %chin% snp_ids$DU6$snp_id),
du6p = (all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = (all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = (all_ids %chin% snp_ids$FZTDU$snp_id))
all_ids <- snp_ids %>% bind_rows() %>% select(-line, -X1, -X2) %>% unique() %>% unlist()
sets <- data.frame(ids = all_ids,
duk = (all_ids %chin% snp_ids$DUK$snp_id),
duc = (all_ids %chin% snp_ids$DUC$snp_id),
du6 = (all_ids %chin% snp_ids$DU6$snp_id),
du6p = (all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = (all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = (all_ids %chin% snp_ids$FZTDU$snp_id))
head(sets)
sets <- sets %>% dplyr::select(-ids)
head(sets)
venn(sets)
xxx <- sets[1:5000,]
venn(xxx)
write.csv(sets, here("00_dashboard/data","snp_id_sets.csv"))
set_dat <- read.csv(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T) %>%
dplyr::select(-X)
head(set_dat)
head(sets)
sets <- data.frame(ids = all_ids,
duk = (all_ids %chin% snp_ids$DUK$snp_id),
duc = (all_ids %chin% snp_ids$DUC$snp_id),
du6 = (all_ids %chin% snp_ids$DU6$snp_id),
du6p = (all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = (all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = (all_ids %chin% snp_ids$FZTDU$snp_id))
head(sets)
write.csv(sets, here("00_dashboard/data","snp_id_sets.csv"))
set_dat <- read.csv(here("00_dashboard/data","snp_id_sets.csv"), stringsAsFactors = F, header = T)
rownames(set_dat) <- set_dat$ids
head(set_dat)
dat_set <- dat_set %>% dplyr::select(-X, ids)
set_dat <- set_dat %>% dplyr::select(-X, ids)
head(set_dat)
set_dat <- set_dat %>% dplyr::select(-X, -ids)
set_dat <- set_dat %>% dplyr::select(-ids)
head(set_dat)
xxx <- set_dat[1:100,]
venn(xxx)
xxx <- set_dat[1:1000,]
venn(xxx)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv"))
head(set_dat)
rownames(set_dat) <- set_dat$ids
head(set_dat)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
rownames(set_dat) <- set_dat$ids
head(set_dat)
set_dat <- set_dat %>% dplyr::select(duc,duk,du6,du6p,duhlb,fztdu)
head(set_dat)
xxx <- set_dat[1:1000,]
venn(xxx)
xxx <- set_dat[1:2000,]
venn(xxx)
display.brewer.pal(n = 8, name = 'RdBu')
library("RColorBrewer")
display.brewer.pal(n = 8, name = 'RdBu')
brewer.pal(n = 8, name = "RdBu")
venn(xxx, zcolors = brewer.pal(n = 7, name = "RdBu"))
venn(xxx, zcolor = brewer.pal(n = 7, name = "RdBu"))
display.brewer.pal(n = 8, name = 'RdBu')
display.brewer.pal(n = 7, name = 'RdBu')
venn(xxx, zcolor = brewer.pal(n = 7, name = "Set1"))
upset(set_dat, nsets = 6,
nintersects = NA,
number.angles = 90,
sets = rev(names(set_dat)[2:7]))
xxxxx <- data.frame(ids = all_ids,
duk = as.integer(all_ids %chin% snp_ids$DUK$snp_id),
duc = as.integer(all_ids %chin% snp_ids$DUC$snp_id),
du6 = as.integer(all_ids %chin% snp_ids$DU6$snp_id),
du6p = as.integer(all_ids %chin% snp_ids$DU6P$snp_id),
duhlb = as.integer(all_ids %chin% snp_ids$DUhLB$snp_id),
fztdu = as.integer(all_ids %chin% snp_ids$FZTDU$snp_id))
head(xxxxx)
rownames(xxxxx) <- xxxxx$ids
head(xxxxx)
upset(xxxxx, nsets = 6,
nintersects = NA,
number.angles = 90,
sets = rev(names(set_dat)[2:7]))
xxxxx <- xxxxx %>% dplyr::select(-ids)
head(xxxxx)
upset(xxxxx,
nsets = 6,
nintersects = NA,
number.angles = 90,
sets = rev(names(set_dat)[2:7]))
upset(xxxxx,
nsets = 6,
nintersects = NA)
?upset
upset(xxxxx,
nsets = 6,
nintersects = NA,
nintersects = 10)
upset(xxxxx,
nsets = 6,
nintersects = 10)
upset(xxxxx,
nsets = 6,
nintersects = 62)
head(set_dat)
set_dat$duc %>% head()
set_dat_bool <- data.frame(
duk = as.integer(set_dat$duk),
duc = as.integer(set_dat$duc),
du6 = as.integer(set_dat$du6),
du6p = as.integer(set_dat$du6p),
duhlb = as.integer(set_dat$duhlb),
fztdu = as.integer(set_dat$fztdu)
)
head(set_dat_bool)
rownames(set_dat_bool) <- rownames(set_dat)
head(set_dat_bool)
head(set_dat_bool)
upset(set_dat_bool,
nsets = 6,
nintersects = 62)
library(UpSetR)
names(set_dat_bool)[1:6]
rev(names(set_dat_bool)[1:6])
rev(names(set_dat_bool)[1:6])
rev(names(set_dat_bool)[1:6])
library(UpSetR)
?upset
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
library(dplyr)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
options(scipen = 999)
library(flexdashboard)
library(dplyr)
library(stringr)
library(ggplot2)
library(reshape2)
library(here)
library(plotly)
library(DT)
library(venn)
library(UpSetR)
library(data.table)
library(vroom)
library(RColorBrewer)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
rownames(set_dat) <- set_dat$ids
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
head(set_dat)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
rownames(set_dat) <- set_dat$ids
set_dat <- set_dat %>% dplyr::select(duc,duk,du6,du6p,duhlb,fztdu)
set_dat_bool <- data.frame(
duk = as.integer(set_dat$duk),
duc = as.integer(set_dat$duc),
du6 = as.integer(set_dat$du6),
du6p = as.integer(set_dat$du6p),
duhlb = as.integer(set_dat$duhlb),
fztdu = as.integer(set_dat$fztdu)
)
head(set_dat_bool)
set_dat <- vroom(here("00_dashboard/data","snp_id_sets.csv")) %>% as.data.frame()
set_dat_bool <- data.frame(
duk = as.integer(set_dat$duk),
duc = as.integer(set_dat$duc),
du6 = as.integer(set_dat$du6),
du6p = as.integer(set_dat$du6p),
duhlb = as.integer(set_dat$duhlb),
fztdu = as.integer(set_dat$fztdu)
)
rownames(set_dat_bool) <- set_dat$ids
head(set_dat_bool)
upset(
set_dat_bool,
nsets = 6,
sets = c("fztdu","duhlb","du6p","du6","duc","duk"),
keep.order = T,
intersections =  list(list("fztdu", "duhlb"))
)
upset(
set_dat_bool,
nsets = 6,
sets = c("fztdu","duhlb","du6p","du6","duc","duk"),
keep.order = T,
intersections =  list(list("fztdu", "duhlb"), list("duk","duc"))
)
upset(
set_dat_bool,
nsets = 6,
sets = c("fztdu","duhlb","du6p","du6","duc","duk"),
keep.order = T,
intersections =  list(
list("fztdu","duhlb","du6p","du6","duc","duk"),
list("duhlb","du6p","du6","duc","duk"),
list("duk")
)
)
upset(
set_dat_bool,
nsets = 6,
sets = c("fztdu","duhlb","du6p","du6","duc","duk"),
keep.order = T,
intersections =  list(
list("fztdu","duhlb","du6p","du6","duc","duk"),
list("duhlb","du6p","du6","duc","duk"),
list("duk"),
list("duc"),
list("du6"),
list("du6p"),
list("duhlb"),
list("fztdu")
)
)
upset(
set_dat_bool,
nsets = 6,
sets = c("fztdu","duhlb","du6p","du6","duc","duk"),
keep.order = T,
intersections =  list(
list("fztdu","duhlb","du6p","du6","duc","duk"),
list("fztdu","duhlb","du6p","du6","duc"),
list("fztdu","duhlb","du6p","du6","duk"),
list("fztdu","duhlb","du6p","duc","duk"),
list("fztdu","duhlb","du6","duc","duk"),
list("fztdu","du6p","du6","duc","duk")
list("duhlb","du6p","du6","duc","duk"),
list("duk"),
list("duc"),
list("du6"),
list("du6p"),
list("duhlb"),
list("fztdu")
)
)
library(here)
library(ggplot2)
library(dplyr)
library(vroom)
dat <- vroom(here("00_dashboard/data/tst.table"))
here()
options(scipen = 999)
library(flexdashboard)
library(dplyr)
library(stringr)
library(ggplot2)
library(reshape2)
library(here)
library(plotly)
library(DT)
library(venn)
library(UpSetR)
library(data.table)
library(vroom)
library(RColorBrewer)
?include_graphics
library(knitr)
