filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
intersect(mda_gigamuga_pos,good_snps2_pos) %>% length() #17001
good_snps2 <- dat2 %>%
filter(
MQ > 55 &
FS < 0.1 &
#QD > 25.0 &
QD > 20.0 &
SOR < 1.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps2) #542740     10
good_snps <- dat %>%
filter(
MQ > 55 &
FS < 0.1 &
#QD > 25.0 &
QD > 10.0 &
SOR < 1.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
good_snps <- dat %>%
filter(
MQ > 55 &
FS < 0.1 &
#QD > 25.0 &
QD > 2.0 &
SOR < 1.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
dim(dat)
good_snps <- dat %>%
filter(
#MQ > 55 &
MQ > 40 &
FS < 0.1 &
#QD > 25.0 &
QD > 2.0 &
SOR < 1.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
good_snps <- dat %>%
filter(
#MQ > 55 &
MQ > 40 &
FS < 0.1 &
#QD > 25.0 &
QD > 2.0 &
#SOR < 1.0) %>%
SOR < 3.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
good_snps <- dat %>%
filter(
MQ > 55 &
FS < 0.1 &
QD > 25.0 &
SOR < 1.0) %>%
filter(
MQRankSum > -0.5 & MQRankSum < 0.5
) %>%
filter(
ReadPosRankSum > -0.5 & ReadPosRankSum < 0.5
)
dim(good_snps) #2732991      10
good_snps %>% head()
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% head()
here()
here() %>% list.files()
here("batches123_03_VariantQualityScoreRecalibration") %>% list.files()
here("batches123_03_VariantQualityScoreRecalibration") %>% list.files()
good_snps %>% head()
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>%
write.table(file=here("batches123_03_VariantQualityScoreRecalibration/truth_training.intervals/data"),quote = F, row.names = F, col.names = F)
here("batches123_03_VariantQualityScoreRecalibration/truth_training.intervals/data")
good_snps %>% head()
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>%
write.table(file=here("batches123_03_VariantQualityScoreRecalibration/data/truth_training.intervals"),quote = F, row.names = F, col.names = F)
good_snps %>% filter(CHROM = 1 & POS > 2.6e+07)
good_snps %>% filter(CHROM = 1 & POS > 2.6e07)
good_snps %>% filter(CHROM == 1 & POS > 2.6e07)
good_snps %>% filter(CHROM == 1 & POS >= 2.6e07)
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% filter(L == "1:2.6e7")
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% filter(L == "1:26000000-26000000")
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% filter(L == "1:26000000-26000000")
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% head()
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>% filter(L == "1:3001579-3001579")
good_snps %>% head()
options(scipen = 999)
good_snps %>% mutate(L=paste0(CHROM,":",POS,"-",POS)) %>% dplyr::select(L) %>%
write.table(file=here("batches123_03_VariantQualityScoreRecalibration/data/truth_training.intervals"),quote = F, row.names = F, col.names = F)
sample_info2 <- read.table("../../sample_info/sample_info_batch3/sample_info.csv")
sample_info2 <- read.csv("../../sample_info/sample_info_batch3/sample_info.csv")
list.file("../../sample_info/sample_info_batch3")
list.files("../../sample_info/sample_info_batch3")
list.files("../../sample_info")
getwd()
sample_info2 <- read.csv("./sample_info_batch3/sample_info.csv")
list.files()
sample_info2 <- read.csv("./sample_info/sample_info_batch3/sample_info.csv")
sample_info1 <- read.csv("./sample_info/sample_info_batch1_batch2.csv")
head(sample_info1)
head(sample_info2)
library(stringr)
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id)
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name)
head(ss1)
head(ss2)
sample_info <- bind_rows(ss1,ss2)
library(dplyr)
library(vroom)
library(stringr)
# sample info batch1-2 (60 samples, ~20x)
sample_info1 <- read.csv("./sample_info/sample_info_batch1_batch2.csv", stringsAsFactors = F)
# sample info last batch (90 samples, ~5x avg-cvg)
sample_info2 <- read.csv("./sample_info/sample_info_batch3/sample_info.csv", stringsAsFactors = F)
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id)
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name)
sample_info <- bind_rows(ss1,ss2)
head(sample_info)
dim(sample_info)
sample_info %>% unique() %>% dim()
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id) %>%
mutate(target_cvg = "30x")
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x")
sample_info <- bind_rows(ss1,ss2)
head(sample_info)
sample_info %>% unique() %>% dim()
gt_tab <- read.table("../output/tst.table", stringsAsFactors = F)
gt_tab <- read.table("../output/tst.table", stringsAsFactors = F)
gt_tab <- read.table("./batches123_04_FinalVCF/output/tst.table", stringsAsFactors = F)
gt_tab
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table", stringsAsFactors = F)
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table")
dim(gt_tab)
head(gt_tab)
head(gt_tab) %>% as.data.frame()
gt_tabl %>% dplyr::select(CHROM,POS) %>% head()
gt_tab %>% dplyr::select(CHROM,POS) %>% head()
gt_tab %>% dplyr::select(-CHROM,-POS) %>% head()
gt_tab %>% head() %>%  dplyr::select(-CHROM,-POS)
gt_tab %>% head() %>%  dplyr::select(-CHROM,-POS) %>% as.data.frame()
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
as.data.frame() %>%
apply(1, function(x){
sum(x == "./.")
})
gt_tab[1,]
gt_tab[1,] %>% as.data.frame()
gt_tab[1,] %>% as.character()
gt_tab[1,3:152] %>% as.character()
gt_tab[1,3:152] %>% as.character() %>% length()
gt_tab[1,3:152] %>% as.character() %>% length() %>% sapply(function(x) x == "./.")
gt_tab[1,3:152] %>% as.character() %>% length() %>% {. == "./."}
gt_tab[1,3:152] %>% as.character() %>% length() %>% {. == "T/T"}
gt_tab[1,3:152] %>% as.character() %>% {. == "T/T"}
gt_tab[1,3:152] %>% as.character() %>% {. == "./."}
gt_tab[1,3:152] %>% as.character() %>% {. == "./."} %>% sum()
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
as.data.frame() %>%
apply(1, function(x){
sum(x == "./.")
})
gt_tab[5,3:152] %>% as.character() %>% {. == "./."} %>% sum()
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
as.data.frame() %>%
apply(1, function(x){
print(x)
sum(x == "./.")
})
gt_tab %>%
head(1) %>%
dplyr::select(-CHROM,-POS)
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
sum(x == "./.")
})
x <- gt_tab %>% head(1) %>%  dplyr::select(-CHROM,-POS)
x
sum(x == "./.")
names(x)
names(gt_tab) <- str_remove(names(gt_tab), ".GT") %>% str_remove("-L1")
names(gt_tab)
setdiff(names(gt_tab), sample_info$sample_id)
intersect(names(gt_tab), sample_info$sample_id) %>% length()
match(sample_info$sample_id, names(gt_tab))
idx <- match(sample_info$sample_id, names(gt_tab))
rm(idx1)
rm(idx)
idx1 <- match(sample_info$sample_id, names(gt_tab))
length(idx1)
sample_info[,idx1] %>% head()
idx1 <- match(sample_info$sample_id, names(gt_tab))
sample_info[,idx1] %>% head()
idx1
gt_tab[,idx1] %>% head()
head(sample_info)
tail(sample_info)
gt_tab[,idx1] %>% as.data.frame() %>% head()
head(sample_info)
tail(sample_info)
tmp1 <- gt_tab[,idx1] %>% as.data.frame() %>% head()
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_rows(tmp1)
gt_tab %>% as.data.frame() %>% head()
tmp1
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table")
names(gt_tab) <- str_remove(names(gt_tab), ".GT") %>% str_remove("-L1")
idx1 <- match(sample_info$sample_id, names(gt_tab))
tmp1 <- gt_tab[,idx1] %>% as.data.frame() %>% head()
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1)
gt_tab
tmp1
gt_tab %>%
dplyr::select(CHROM,POS)
gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1)
tmp1
tmp1 <- gt_tab[,idx1]
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1)
gt_tab
gt_tab %>% as.data.frame() %>% head()
library(dplyr)
library(vroom)
library(stringr)
# sample info batch1-2 (60 samples, ~20x)
sample_info1 <- read.csv("./sample_info/sample_info_batch1_batch2.csv", stringsAsFactors = F)
# sample info last batch (90 samples, ~5x avg-cvg)
sample_info2 <- read.csv("./sample_info/sample_info_batch3/sample_info.csv", stringsAsFactors = F)
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id) %>%
mutate(target_cvg = "30x")
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x")
sample_info <- bind_rows(ss1,ss2)
ss1$Linie %>% unique()
ss2$Linie %>% unique()
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x",
Linie = ifelse(Linie == "HLB", "DUhLB", "DUhLB"))
ss2$Linie %>% unique()
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x",
Linie = ifelse(Linie == "HLB", "DUhLB", Linie))
ss2$Linie %>% unique()
sample_info <- bind_rows(ss1,ss2) %>%
mutate(Linie = factor(Linie, c("DUK","DUC","DU6","DU6P","DUhLB","FZTDU"))) %>%
arrange(Linie, sample_id)
View(sample_info)
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table")
names(gt_tab) <- str_remove(names(gt_tab), ".GT") %>% str_remove("-L1")
idx1 <- match(sample_info$sample_id, names(gt_tab))
tmp1 <- gt_tab[,idx1]
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1)
View(sample_info)
gt_tab %>% as.data.frame() %>% head()
gt_tab %>% as.data.frame() %>% .[1:3,1:15]
gt_tab %>% as.data.frame() %>% .[1:3,1:25]
gt_tab %>% as.data.frame() %>%  %>% .[,3:152] %>% .[1:3,1:25]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,1:25]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,26:50]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,51:76]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,76:100]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,101:125]
gt_tab %>% as.data.frame() %>% .[,3:152] %>% .[1:3,126:150]
x <- gt_tab %>% head(1) %>%  dplyr::select(-CHROM,-POS)
sum(x == "./.")
names(x)
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
sum(x == "./.")
})
x <- gt_tab %>% head(1) %>%  dplyr::select(-CHROM,-POS)
sum(x == "./.")
names(x)
tapply(x, sample_info$Linie, function(gt) sum(gt == "./."))
x
sample_info$Linie
library(dplyr)
library(vroom)
library(stringr)
# sample info batch1-2 (60 samples, ~20x)
sample_info1 <- read.csv("./sample_info/sample_info_batch1_batch2.csv", stringsAsFactors = F)
# sample info last batch (90 samples, ~5x avg-cvg)
sample_info2 <- read.csv("./sample_info/sample_info_batch3/sample_info.csv", stringsAsFactors = F)
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id) %>%
mutate(target_cvg = "30x")
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x",
Linie = ifelse(Linie == "HLB", "DUhLB", Linie))
sample_info <- bind_rows(ss1,ss2) %>%
mutate(Linie = factor(Linie, c("DUK","DUC","DU6","DU6P","DUhLB","FZTDU"))) %>%
arrange(Linie, sample_id)
# Load genotype table
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table")
# Prepare col names
names(gt_tab) <- str_remove(names(gt_tab), ".GT") %>% str_remove("-L1")
# Match order of table and sample info
idx1 <- match(sample_info$sample_id, names(gt_tab))
tmp1 <- gt_tab[,idx1]
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1) %>%
mutate(Linie = as.character(Linie))
library(dplyr)
library(vroom)
library(stringr)
# sample info batch1-2 (60 samples, ~20x)
sample_info1 <- read.csv("./sample_info/sample_info_batch1_batch2.csv", stringsAsFactors = F)
# sample info last batch (90 samples, ~5x avg-cvg)
sample_info2 <- read.csv("./sample_info/sample_info_batch3/sample_info.csv", stringsAsFactors = F)
# Combine both data sets
ss1 <- sample_info1 %>%
dplyr::select(Linie, sample_id) %>%
mutate(target_cvg = "30x")
ss2 <- sample_info2 %>% dplyr::select(Linie, name) %>%
mutate(name = str_remove(name,"-S1")) %>%
dplyr::rename(sample_id = name) %>%
mutate(target_cvg = "5x",
Linie = ifelse(Linie == "HLB", "DUhLB", Linie))
sample_info <- bind_rows(ss1,ss2) %>%
mutate(Linie = factor(Linie, c("DUK","DUC","DU6","DU6P","DUhLB","FZTDU"))) %>%
arrange(Linie, sample_id) %>%
mutate(Linie = as.character(Linie))
# Load genotype table
gt_tab <- vroom("./batches123_04_FinalVCF/output/tst.table")
# Prepare col names
names(gt_tab) <- str_remove(names(gt_tab), ".GT") %>% str_remove("-L1")
# Match order of table and sample info
idx1 <- match(sample_info$sample_id, names(gt_tab))
tmp1 <- gt_tab[,idx1]
gt_tab <- gt_tab %>%
dplyr::select(CHROM,POS) %>%
bind_cols(tmp1)
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
sum(x == "./.")
})
x <- gt_tab %>% head(1) %>%  dplyr::select(-CHROM,-POS)
sum(x == "./.")
tapply(x, sample_info$Linie, function(gt) sum(gt == "./."))
sample_info$Linie
?tapply
x
x <- gt_tab %>% head(1) %>%  dplyr::select(-CHROM,-POS) %>% as.character()
sum(x == "./.")
x
tapply(x, sample_info$Linie, function(gt) sum(gt == "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") == 15)
i=2
x <- gt_tab %>% .[i,] %>%  dplyr::select(-CHROM,-POS) %>% as.character()
x
tapply(x, sample_info$Linie, function(gt) sum(gt != "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") == 15)
tapply(x, sample_info$Linie, function(gt) sum(gt != "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15)
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15)
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15)
tapply(x, sample_info$Linie, function(gt) all(sum(gt != "./.") >= 15))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15) %>% all()
i=3
x <- gt_tab %>% .[i,] %>%  dplyr::select(-CHROM,-POS) %>% as.character()
x
tapply(x, sample_info$Linie, function(gt) sum(gt != "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15)
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15) %>% all()
i=4
x <- gt_tab %>% .[i,] %>%  dplyr::select(-CHROM,-POS) %>% as.character()
x
tapply(x, sample_info$Linie, function(gt) sum(gt != "./."))
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15)
tapply(x, sample_info$Linie, function(gt) sum(gt != "./.") >= 15) %>% all()
i=4
x <- gt_tab %>% .[i,] %>%  dplyr::select(-CHROM,-POS) %>% as.character()
x
tapply(x, sample_info$Linie, function(gt) mean(gt != "./."))
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5)
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
i=6
x <- gt_tab %>% .[i,] %>%  dplyr::select(-CHROM,-POS) %>% as.character()
x
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5)
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
x
x
tapply(x, sample_info$Linie, function(gt) mean(gt != "./."))
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5)
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
gt_tab %>%
head() %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
})
dim(gt_tab)
gt_tab %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
})
idx2 <- gt_tab %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.5) %>% all()
})
gt_tab %>%
dplyr::select(CHROM,POS) %>%
.[idx2,]
gt_tab %>%
dplyr::select(CHROM,POS) %>%
.[idx2,] %>%
mutate(tmp = paste0(CHROM,":",POS,"-",POS)) %>%
dplyr::select(tmp)
25/2
idx2 <- gt_tab %>%
dplyr::select(-CHROM,-POS) %>%
apply(1, function(x){
tapply(x, sample_info$Linie, function(gt) mean(gt != "./.") >= 0.9) %>% any()
})
gt_tab %>%
dplyr::select(CHROM,POS) %>%
.[idx2,] %>%
mutate(tmp = paste0(CHROM,":",POS,"-",POS)) %>%
dplyr::select(tmp)
# Get intervals
gt_tab %>%
dplyr::select(CHROM,POS) %>%
.[idx2,] %>%
mutate(tmp = paste0(CHROM,":",POS,"-",POS)) %>%
dplyr::select(tmp) %>%
write.table("./batches123_04_FinalVCF/output/keep_snps.intervals")
gt_tab %>%
dplyr::select(CHROM,POS) %>%
.[idx2,] %>%
mutate(tmp = paste0(CHROM,":",POS,"-",POS)) %>%
dplyr::select(tmp) %>%
write.table("./batches123_04_FinalVCF/output/keep_snps.intervals", quote = F, col.names = F, row.names = F)
